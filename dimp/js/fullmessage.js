var DimpFullmessage={quickreply:function(A){var B;$("msgData").hide();$("qreply").show();switch(A){case"reply":case"reply_all":case"reply_list":B="GetReplyData";break;case"forward_all":case"forward_body":case"forward_attachments":B="GetForwardData";break}DimpCore.doAction(B,{imp_compose:$F("messageCache"),type:A},[DimpCore.toUIDString($F("index"),$F("folder"))],this.msgTextCallback.bind(this))},msgTextCallback:function(B){if(!B.response){return}var D=B.response,A=((D.format=="html")&&!DimpCompose.editor_on),E=(D.identity===null)?$F("identity"):D.identity,C=DimpCompose.get_identity(E,A);$("identity","last_identity").invoke("setValue",E);DimpCompose.fillForm((C.id[2])?("\n"+C.sig+D.body):(D.body+"\n"+C.sig),D.header);if(D.fwd_list&&D.fwd_list.length){D.fwd_list.each(function(F){DimpCompose.addAttach(F.number,F.name,F.type,F.size)})}if(A){DimpCompose.toggleHtmlEditor(true)}if(D.imp_compose){$("messageCache").setValue(D.imp_compose)}}};document.observe("dom:loaded",function(){window.focus();DimpCore.buildAddressLinks("msgHeaders");DimpCore.messageOnLoad();DimpCore.addPopdown("reply_link","replypopdown");DimpCore.addPopdown("forward_link","fwdpopdown");var A=DimpCore.clickObserveHandler;A({d:$("windowclose"),f:function(){window.close()}});A({d:$("reply_link"),f:DimpFullmessage.quickreply.bind(DimpFullmessage,"reply")});A({d:$("forward_link"),f:DimpFullmessage.quickreply.bind(DimpFullmessage,DIMP.conf.forward_default)});["spam","ham","deleted"].each(function(B){var C=$("button_"+B);if(C){A({d:C,f:function(D){DIMP.baseWindow.DimpBase.flag(D,DIMP.conf.msg_index,DIMP.conf.msg_folder);window.close()}.curry(B)})}});A({d:$("qreply").select("div.headercloseimg img").first(),f:DimpCompose.confirmCancel.bind(DimpCompose)});["reply","reply_all","reply_list"].each(function(B){var C=$("ctx_replypopdown_"+B);if(C){A({d:C,f:DimpFullmessage.quickreply.bind(DimpFullmessage,B),ns:true})}});["forward_all","forward_body","forward_attachments"].each(function(B){A({d:$("ctx_fwdpopdown_"+B),f:DimpFullmessage.quickreply.bind(DimpFullmessage,B),ns:true})})});