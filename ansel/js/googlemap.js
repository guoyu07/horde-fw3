var Ansel_GMap=Class.create();Ansel_GMap.prototype={mainMap:undefined,bounds:undefined,geocoder:undefined,smallMap:undefined,tilePrefix:"imagetile_",locationId:"ansel_locationtext",maxZoom:15,defaultZoom:15,options:{},initialize:function(A){this.mainMap=new GMap2($(A.mainMap));this.mainMap.setMapType(G_HYBRID_MAP);this.mainMap.setUIToDefault();this.bounds=new GLatLngBounds();this.geocoder=new GClientGeocoder();this.options=A;if(A.useManager==true){this.manager=new MarkerManager(this.mainMap)}if(A.tilePrefix){this.tilePrefix=A.tilePrefix}if(A.smallMap){this.smallMap=new GMap2($(A.smallMap))}document.observe("unload",function(){GUnload()})},addPoint:function(G,C,D,B){if(!B){var B={}}var F=new GLatLng(G,C);this.bounds.extend(F);if(B.markerOnly==true){var A=new GMarker(F,B)}else{var A=new anselGOverlay(F,D)}if(!B.markerOnly){GEvent.addDomListener(A.div_,"click",function(){a=$$("#"+this.tilePrefix+D.id+" a")[0];if(!a.onclick||a.onclick()!=false){location.href=a.href}}.bind(this))}if(this.options.smallMap){var E=new GMarker(F);this.smallMap.addOverlay(E)}if(this.options.useManager){}else{this.mainMap.addOverlay(A);this.geocoder.getLocations(F,function(H){this._locationCallBack(H,A,D)}.bind(this))}},_locationCallBack:function(D,B,E){for(var C=0;C<D.Placemark.length;C++){var A=D.Placemark[C];if(A.AddressDetails.Accuracy<=4){if(!this.options.markerOnly&&this.options.viewType!="Image"){GEvent.addDomListener(B.div_,"mouseover",function(){$(this.locationId).update(A.address);$$("#"+this.tilePrefix+E.id+" img")[0].toggleClassName("image-tile-highlight");B.focus()}.bind(this));GEvent.addDomListener(B.div_,"mouseout",function(){$(this.locationId).update("<br />");$$("#"+this.tilePrefix+E.id+" img")[0].toggleClassName("image-tile-highlight");B.focus()}.bind(this))}if(options.viewType!="Image"){$$("#"+this.tilePrefix+E.id+" img")[0].observe("mouseover",function(){$(this.locationId).update(A.address);$$("#"+this.tilePrefix+E.id+" img")[0].toggleClassName("image-tile-highlight");B.focus()}.bind(this));$$("#"+this.tilePrefix+E.id+" img")[0].observe("mouseout",function(){$(this.locationId).update("<br />");$$("#"+this.tilePrefix+E.id+" img")[0].toggleClassName("image-tile-highlight");B.div_.style.border="1px solid white";B.focus()}.bind(this));return}else{$(this.locationId).update(A.address);return}}else{}}},display:function(){if(this.options.viewType=="Gallery"){var A=0;this.mainMap.getCurrentMapType().getMaxZoomAtLatLng(this.bounds.getCenter(),function(B){this.mainMap.setCenter(this.bounds.getCenter(),Math.min(this.mainMap.getBoundsZoomLevel(this.bounds),Math.max(this.maxZoom,B.zoom)));if(this.options.smallMap){this.smallMap.setCenter(this.mainMap.getCenter(),1)}}.bind(this))}else{this.mainMap.setCenter(this.bounds.getCenter(),this.defaultZoom);if(this.options.smallMap){this.smallMap.setCenter(this.mainMap.getCenter(),1)}}},};Event.observe(window,"dom:loaded",function(){anselGOverlay=function(D,B){this.src_=B.icon;this.latlng_=D;var A=new Image();A.src=B.icon;this.width_=A.width;this.height_=A.height;var C=GOverlay.getZIndex(this.latlng_.lat());this.div_=new Element("div",{style:"position:absolute;border:1px solid white;width:"+(this.width_-2)+"px; height:"+(this.height_-2)+"px;zIndex:"+C});this.img_=new Element("img",{src:this.src_,style:"width:"+(this.width_-2)+"px;height:"+(this.height_-2)+"px"});this.div_.appendChild(this.img_);this.selected_=false};anselGOverlay.prototype=new GOverlay();anselGOverlay.prototype.initialize=function(A){A.getPane(G_MAP_MARKER_PANE).appendChild(this.div_);this.map_=A};anselGOverlay.prototype.remove=function(){this.div_.parentNode.removeChild(this.div_)};anselGOverlay.prototype.copy=function(){return new Ansel_GOverlay(this.latlng_,this.src_)};anselGOverlay.prototype.redraw=function(B){if(!B){return}var A=this.map_.fromLatLngToDivPixel(this.latlng_);this.div_.style.left=A.x+"px";this.div_.style.top=A.y+"px"};anselGOverlay.prototype.focus=function(){if(this.selected_==false){this.div_.style.border="1px solid red";this.div_.style.left=(parseInt(this.div_.style.left)-1)+"px";this.div_.style.top=(parseInt(this.div_.style.top)-1)+"px";this.div_.style.zIndex=GOverlay.getZIndex(-90);this.selected_=true}else{this.div_.style.border="1px solid white";this.div_.style.left=(parseInt(this.div_.style.left)+1)+"px";this.div_.style.top=(parseInt(this.div_.style.top)+1)+"px";this.div_.style.zIndex=GOverlay.getZIndex(this.latlng_.lat());this.selected_=false}}});