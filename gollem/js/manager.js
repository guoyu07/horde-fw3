var Gollem={toggleRow:function(){$$("table.striped tr").each(function(a){var b=a.select("TD");a.observe("mouseover",b.invoke.bind(b,"addClassName","selected"));a.observe("mouseout",b.invoke.bind(b,"removeClassName","selected"))})},getChecked:function(){return this.getElements().findAll(function(a){return a.checked})},getElements:function(){return $("manager").getInputs(null,"items[]")},getSelected:function(){return this.getChecked().pluck("value").join("\n")},getItemsArray:function(){var a=0,b=$("manager").getInputs(null,"itemTypes[]");return this.getElements().collect(function(c){return{c:c.checked,v:c.value,t:b[a++].value}})},getSelectedFoldersList:function(){return this.getItemsArray().collect(function(a){return(a.c&&a.t=="**dir")?a.v:null}).compact().join("\n")},chooseAction:function(a){var b=$F("action"+a);switch(b){case"paste_items":$("actionID").setValue("paste_items");$("manager").submit();break;default:if(!this.getChecked().size()){alert(GollemText.select_item);break}switch(b){case"rename_items":this.renameItems();break;case"delete_items":this.deleteItems();break;case"chmod_modify":$("attributes").show();break;case"cut_items":$("actionID").setValue("cut_items");$("manager").submit();break;case"copy_items":$("actionID").setValue("copy_items");$("manager").submit();break}break}},renameItems:function(){var a=this.getChecked();if(a.size()){a[0].checked=false;$("rename").show();$("renamefrm_oldname").setValue(a[0].value);$("renamefrm_newname").setValue(a[0].value).focus()}},deleteItems:function(){var a=true,b;if(window.confirm(GollemText.delete_confirm_1+"\n"+this.getSelected()+"\n"+GollemText.delete_confirm_2)){if(warn_recursive){b=this.getSelectedFoldersList();if(!b.empty()&&!window.confirm(GollemText.delete_recurs_1+"\n"+b+"\n"+GollemText.delete_recurs_2)){a=false}}}else{a=false}if(a){$("actionID").setValue("delete_items");$("manager").submit()}},toggleSelection:function(){var b=this.getElements(),a=(this.getChecked().size()!=b.length);b.each(function(c){c.checked=a})},createFolderOK:function(){$("createFolder").hide();if($F("createfrm_fname")){$("new_folder").setValue($F("createfrm_fname"));$("actionID").setValue("create_folder");$("manager").submit()}},createFolderKeyCheck:function(a){switch(a.keyCode){case Event.KEY_ESC:this.createFolderCancel();return false;case EVENT.KEY_RETURN:this.createFolderOK();return false}return true},createFolderCancel:function(){$("createFolder").hide();$("createfrm").reset()},chmodCancel:function(){$("attributes").hide();$("chmodfrm").reset()},chmodSave:function(){var a=group=owner=0;$("chmodfrm").getElements().each(function(b){if(b.name=="owner[]"&&b.checked){owner|=b.value}else{if(b.name=="group[]"&&b.checked){group|=b.value}else{if(b.name=="all[]"&&b.checked){a|=b.value}}}});$("attributes").hide();$("chmod").setValue("0"+owner+""+group+""+a);$("actionID").setValue("chmod_modify");$("manager").submit()},renameOK:function(){var f=this.getChecked(),b=$F("renamefrm_newname"),e=$F("new_names"),d=$F("renamefrm_oldname"),a=$F("old_names");if(b&&b!=d){e+="|"+b;a+="|"+d}if(e.startsWith("|")){e=e.substring(1)}if(a.startsWith("|")){a=a.substring(1)}$("new_names").setValue(e);$("old_names").setValue(a);if(f.size()){f[0].checked=false;found=true;$("rename").show();$F(f[0]).focus()}else{$("actionID").setValue("rename_items");$("manager").submit()}return false},renameCancel:function(){$("new_names","old_names").invoke("setValue","");$("rename").hide()},renameKeyCheck:function(a){switch(a.keyCode){case Event.KEY_ESC:this.renameCancel();return false;case EVENT.KEY_RETURN:this.renameOK();return false}return true},changeDirectoryOK:function(){$("changeDirectory").hide();if($F("cdfrm_fname")){$("dir").setValue($F("cdfrm_fname"));$("manager").submit()}},changeDirectoryKeyCheck:function(a){switch(a.keyCode){case Event.KEY_ESC:this.changeDirectoryCancel();return false;case EVENT.KEY_RETURN:this.changeDirectoryOK();return false}return true},changeDirectoryCancel:function(){$("changeDirectory").hide();$("cdfrm").reset()},uploadFields:function(){return $("manager").getInputs("file").collect(function(a){return(a.name.substr(0,12)=="file_upload_")?a:null}).compact()},uploadFile:function(){if(this.uploadsExist()){$("actionID").setValue("upload_file");$("manager").submit()}},applyFilter:function(){$("manager").submit()},clearFilter:function(){$("filter").setValue("");this.applyFilter()},uploadsExist:function(){if(GollemVar.empty_input||this.uploadFields().find(function(a){return $F(a)})){return true}alert(GollemText.specify_upload);$("file_upload_1").focus();return false},uploadChanged:function(){if(GollemVar.empty_input){return}var b,d,a=this.uploadFields(),c=a.findAll(function(e){return $F(e).length}).length;if(c==a.length){d=$("upload_row_"+c);if(d){b=new Element("INPUT",{type:"file",name:"file_upload_"+(c+1),size:25});d.insert({after:new Element("DIV",{id:"upload_row_"+(c+1)}).insert(new Element("STRONG").insert(GollemText.file+" "+(c+1)+":")).insert(" ").insert(b)});b.observe("change",this.uploadChanged.bind(this))}}},doPrefsUpdate:function(b,a){try{new Ajax.Request(GollemVar.prefs_api,{parameters:{app:"gollem",pref:"sortby",value:b.substring(1)}});new Ajax.Request(GollemVar.prefs_api,{parameters:{app:"gollem",pref:"sortdir",value:a}})}catch(c){}},clickHandler:function(b){if(b.isRightClick()){return}var a=b.element();while(Object.isElement(a)){switch(a.readAttribute("id")){case"createfolder":this._prepPopup("createFolder",a);$("createfrm_fname").focus();return;case"changefolder":this._prepPopup("changeDirectory",a);$("cdfrm_fname").focus();return}a=a.up()}},_prepPopup:function(a,b){this.getChecked().each(function(c){c.checked=false});$(a).clonePosition(b,{setWidth:false,setHeight:false,offsetTop:b.getHeight()}).show()}};function table_sortCallback(c,b,a){if(Gollem.prefs_update_timeout){window.clearTimeout(Gollem.prefs_update_timeout)}Gollem.prefs_update_timeout=Gollem.doPrefsUpdate.bind(this,b,a).delay(0.3)}document.observe("dom:loaded",function(){Gollem.toggleRow();document.observe("click",Gollem.clickHandler.bindAsEventListener(Gollem))});