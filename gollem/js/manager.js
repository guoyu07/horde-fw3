var Gollem={toggleRow:function(){$$("table.striped tr").each(function(A){var B=A.select("TD");A.observe("mouseover",B.invoke.bind(B,"addClassName","selected"));A.observe("mouseout",B.invoke.bind(B,"removeClassName","selected"))})},getChecked:function(){return this.getElements().findAll(function(A){return A.checked})},getElements:function(){return $("manager").getInputs(null,"items[]")},getSelected:function(){return this.getChecked().pluck("value").join("\n")},getItemsArray:function(){var A=0,B=$("manager").getInputs(null,"itemTypes[]");return this.getElements().collect(function(C){return{c:C.checked,v:C.value,t:B[A++].value}})},getSelectedFoldersList:function(){return this.getItemsArray().collect(function(A){return(A.c&&A.t=="**dir")?A.v:null}).compact().join("\n")},chooseAction:function(A){var B=$F("action"+A);switch(B){case"paste_items":$("actionID").setValue("paste_items");$("manager").submit();break;default:if(!this.getChecked().size()){alert(GollemText.select_item);break}switch(B){case"rename_items":this.renameItems();break;case"delete_items":this.deleteItems();break;case"chmod_modify":$("attributes").show();break;case"cut_items":$("actionID").setValue("cut_items");$("manager").submit();break;case"copy_items":$("actionID").setValue("copy_items");$("manager").submit();break}break}},changeDirectory:function(A){this._prepPopup("changeDirectory",A.element());$("cdfrm_fname").focus();A.stop()},createFolder:function(A){this._prepPopup("createFolder",A.element());$("createfrm_fname").focus();A.stop()},_prepPopup:function(A,B){this.getChecked().each(function(C){C.checked=false});$(A).clonePosition(B,{setWidth:false,setHeight:false,offsetTop:B.getHeight()}).show()},renameItems:function(){var A=this.getChecked();if(A.size()){A[0].checked=false;$("rename").show();$("renamefrm_oldname").setValue(A[0].value);$("renamefrm_newname").setValue(A[0].value).focus()}},deleteItems:function(){var A=true,B;if(window.confirm(GollemText.delete_confirm_1+"\n"+this.getSelected()+"\n"+GollemText.delete_confirm_2)){if(warn_recursive){B=this.getSelectedFoldersList();if(!B.empty()&&!window.confirm(GollemText.delete_recurs_1+"\n"+B+"\n"+GollemText.delete_recurs_2)){A=false}}}else{A=false}if(A){$("actionID").setValue("delete_items");$("manager").submit()}},toggleSelection:function(){var B=this.getElements(),A=(this.getChecked().size()!=B.length);B.each(function(C){C.checked=A})},createFolderOK:function(){$("createFolder").hide();if($F("createfrm_fname")){$("new_folder").setValue($F("createfrm_fname"));$("actionID").setValue("create_folder");$("manager").submit()}},createFolderKeyCheck:function(A){switch(A.keyCode){case Event.KEY_ESC:this.createFolderCancel();return false;case EVENT.KEY_RETURN:this.createFolderOK();return false}return true},createFolderCancel:function(){$("createFolder").hide();$("createfrm").reset()},chmodCancel:function(){$("attributes").hide();$("chmodfrm").reset()},chmodSave:function(){var A=group=owner=0;$("chmodfrm").getElements().each(function(B){if(B.name=="owner[]"&&B.checked){owner|=B.value}else{if(B.name=="group[]"&&B.checked){group|=B.value}else{if(B.name=="all[]"&&B.checked){A|=B.value}}}});$("attributes").hide();$("chmod").setValue("0"+owner+""+group+""+A);$("actionID").setValue("chmod_modify");$("manager").submit()},renameOK:function(){var E=this.getChecked(),B=$F("renamefrm_newname"),D=$F("new_names"),C=$F("renamefrm_oldname"),A=$F("old_names");if(B&&B!=C){D+="|"+B;A+="|"+C}if(D.startsWith("|")){D=D.substring(1)}if(A.startsWith("|")){A=A.substring(1)}$("new_names").setValue(D);$("old_names").setValue(A);if(E.size()){E[0].checked=false;found=true;$("rename").show();$F(E[0]).focus()}else{$("actionID").setValue("rename_items");$("manager").submit()}return false},renameCancel:function(){$("new_names","old_names").invoke("setValue","");$("rename").hide()},renameKeyCheck:function(A){switch(A.keyCode){case Event.KEY_ESC:this.renameCancel();return false;case EVENT.KEY_RETURN:this.renameOK();return false}return true},changeDirectoryOK:function(){$("changeDirectory").hide();if($F("cdfrm_fname")){$("dir").setValue($F("cdfrm_fname"));$("manager").submit()}},changeDirectoryKeyCheck:function(A){switch(A.keyCode){case Event.KEY_ESC:this.changeDirectoryCancel();return false;case EVENT.KEY_RETURN:this.changeDirectoryOK();return false}return true},changeDirectoryCancel:function(){$("changeDirectory").hide();$("cdfrm").reset()},uploadFields:function(){return $("manager").getInputs("file").collect(function(A){return(A.name.substr(0,12)=="file_upload_")?A:null}).compact()},uploadFile:function(){if(this.uploadsExist()){$("actionID").setValue("upload_file");$("manager").submit()}},applyFilter:function(){$("manager").submit()},clearFilter:function(){$("filter").setValue("");this.applyFilter()},uploadsExist:function(){if(GollemVar.empty_input||this.uploadFields().find(function(A){return $F(A)})){return true}alert(GollemText.specify_upload);$("file_upload_1").focus();return false},uploadChanged:function(){if(GollemVar.empty_input){return}var B,D,A=this.uploadFields(),C=A.findAll(function(E){return $F(E).length}).length;if(C==A.length){D=$("upload_row_"+C);if(D){B=new Element("INPUT",{type:"file",name:"file_upload_"+(C+1),size:25});D.insert({after:new Element("DIV",{id:"upload_row_"+(C+1)}).insert(new Element("STRONG").insert(GollemText.file+" "+(C+1)+":")).insert(" ").insert(B)});B.observe("change",this.uploadChanged.bind(this))}}},doPrefsUpdate:function(B,A){try{new Ajax.Request(GollemVar.prefs_api,{parameters:{app:"gollem",pref:"sortby",value:B.substring(1)}});new Ajax.Request(GollemVar.prefs_api,{parameters:{app:"gollem",pref:"sortdir",value:A}})}catch(C){}}};function table_sortCallback(C,B,A){if(Gollem.prefs_update_timeout){window.clearTimeout(Gollem.prefs_update_timeout)}Gollem.prefs_update_timeout=Gollem.doPrefsUpdate.bind(this,B,A).delay(0.3)}document.observe("dom:loaded",function(){var A;Gollem.toggleRow();if(A=$("createfolder")){A.observe("click",Gollem.createFolder.bindAsEventListener(Gollem))}if(A=$("changefolder")){A.observe("click",Gollem.changeDirectory.bindAsEventListener(Gollem))}});